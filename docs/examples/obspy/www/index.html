<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset='utf-8'>
    <title>Obspy Dataset View</title>
    <style>
      div.seismograph {
        height: 300px;
      }
    </style>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  </head>
  <body>
    <div id='message'></div>

    <h3>ObsPy Plotting</h3>
    <button id="refresh">Refresh</button>
    <button id="websocketHi">Say Hi</button>
    <h3 id="title">Seismograph!</h3>
    <div class="seismograph" id="myseismograph">
    </div>

    <script src="seisplotjs_2.0.0-alpha.6_standalone.js"></script>
    <script src="viewObspy.js"></script>
    <script>
      //const baseUrl = document.URL;
      const baseUrl = 'http://localhost:8000';
      seisplotjs.d3.select("button#refresh").on("click", function(d) {
        loadDataset(baseUrl);
      });
      loadDataset(baseUrl);
      const wsUrl = 'ws://localhost:8001';
      const handler = function(json) {
        console.log("hey I got something!");
      };
      const errHandler = function(err) {
        console.assert(false, err);
        console.log(`oops ${err}`);
        console.log(`   ${err.message}`)
      }
      const wsConn = new ObsPyConnection(wsUrl, handler, errHandler);
      wsConnIsOK = false;
      wsConn.connect().then( () => {
        console.log("after ws connect, send something back...");
        wsConn.sendMessage("hi obspy!");
      }).then( () => {
        console.log("after ws connect, send something back...");
        wsConn.sendMessage("hi obspy 2!");
      }).then( () => {
        console.log("after ws connect, send something back...");
        wsConn.sendMessage("hi obspy  3!");
        wsConnIsOK = true;
      });

      seisplotjs.d3.select("button#websocketHi").on("click", function(d) {
        if (wsConnIsOK) {
          wsConn.sendMessage("Howdy howdy");
        } else {
          console.log("wsConn not yet ok");
        }
      });

    </script>
  </body>
</html>
